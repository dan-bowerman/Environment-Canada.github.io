<!DOCTYPE html>

<html>
<head>
  <title>gui.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="basemapselector.html">
                basemapselector.js
              </a>
            
              
              <a class="source" href="bookmarkLink.html">
                bookmarkLink.js
              </a>
            
              
              <a class="source" href="datagrid.html">
                datagrid.js
              </a>
            
              
              <a class="source" href="datagridClickHandler.html">
                datagridClickHandler.js
              </a>
            
              
              <a class="source" href="eventManager.html">
                eventManager.js
              </a>
            
              
              <a class="source" href="featureClickHandler.html">
                featureClickHandler.js
              </a>
            
              
              <a class="source" href="featureHighlighter.html">
                featureHighlighter.js
              </a>
            
              
              <a class="source" href="filterManager.html">
                filterManager.js
              </a>
            
              
              <a class="source" href="globalStorage.html">
                globalStorage.js
              </a>
            
              
              <a class="source" href="graphicExtension.html">
                graphicExtension.js
              </a>
            
              
              <a class="source" href="gui.html">
                gui.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="maptips.html">
                maptips.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="quickzoom.html">
                quickzoom.js
              </a>
            
              
              <a class="source" href="ramp.html">
                ramp.js
              </a>
            
              
              <a class="source" href="RAMP-starter.html">
                RAMP-starter.js
              </a>
            
              
              <a class="source" href="array.html">
                array.js
              </a>
            
              
              <a class="source" href="decorator.html">
                decorator.js
              </a>
            
              
              <a class="source" href="dictionary.html">
                dictionary.js
              </a>
            
              
              <a class="source" href="functionMangler.html">
                functionMangler.js
              </a>
            
              
              <a class="source" href="popupManager.html">
                popupManager.js
              </a>
            
              
              <a class="source" href="prototype.html">
                prototype.js
              </a>
            
              
              <a class="source" href="tmplHelper.html">
                tmplHelper.js
              </a>
            
              
              <a class="source" href="tmplUtil.html">
                tmplUtil.js
              </a>
            
              
              <a class="source" href="url.html">
                url.js
              </a>
            
              
              <a class="source" href="util.html">
                util.js
              </a>
            
              
              <a class="source" href="bootstrapper.html">
                bootstrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>gui.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>ï»¿<span class="hljs-comment">/*global define, $, window */</span>
<span class="hljs-comment">/*jslint white: true */</span>

<span class="hljs-comment">/**
* UI submodule
*
* @module RAMP
* @submodule UI
* @main UI
*/</span>

<span class="hljs-comment">/**
* A class for handling most of the GUI on the page.
*
* @class GUI
* @static
* @uses dojo/_base/array
* @uses dojo/topic
* @uses dojo/_base/lang
* @uses dojo/Deferred
* @uses dojo/domReady!
* @uses GlobalStorage
* @uses Util
* @uses Dictionary
* @uses PopupManager
* @uses templates/sub_panel_Template.html
* @uses templates/sub_panel_content_Template.html
*/</span>
define([</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/_base/array"</span>, <span class="hljs-string">"dojo/topic"</span>, <span class="hljs-string">"dojo/_base/lang"</span>, <span class="hljs-string">"dojo/Deferred"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"ramp/globalStorage"</span>, <span class="hljs-string">"ramp/eventManager"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/text!./templates/sub_panel_Template.html"</span>,
        <span class="hljs-string">"dojo/text!./templates/sub_panel_content_Template.html"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"utils/util"</span>, <span class="hljs-string">"utils/dictionary"</span>, <span class="hljs-string">"utils/popupManager"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Dom Ready</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"dojo/domReady!"</span>
    ],

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Dojo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dojoArray, topic, lang, Deferred,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Ramp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        GlobalStorage, EventManager,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        subPanelTemplate,
        subPanelContentTemplate,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Util</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        util, utilDict, popupManager) {
        <span class="hljs-string">"use strict"</span>;

        <span class="hljs-keyword">var</span> jWindow = $(window),

            wbHead = $(<span class="hljs-string">"#wb-head"</span>),
            wbCore = $(<span class="hljs-string">"#wb-core"</span>),
            wbMainIn = $(<span class="hljs-string">"#wb-main-in"</span>),
            wbFoot = $(<span class="hljs-string">"#wb-foot"</span>),

            panelTabs = $(<span class="hljs-string">"ul#tabs"</span>),

            mapDiv = $(<span class="hljs-string">"#map-div"</span>),
            mapContent = $(<span class="hljs-string">"#mapContent"</span>),
            loadIndicator = mapContent.find(<span class="hljs-string">"#map-load-indicator"</span>),

            subPanels = {},</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>subPanelAttribute definition</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * A class holding properties of the SubPanel.
        *
        * @class SubPanelSettings
        * @for SubPanel
        */</span>
            subPanelAttr = {
                <span class="hljs-comment">/**
                * A name used to identify the subpanel being opened (e.g. "Details", "Metadata")
                *
                * @property panelName
                * @for SubPanelSettings
                * @type {String}
                * @default ""
                */</span>
                panelName: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Title of the content to be displayed on the SubPanel (e.g. "CESI Water Quality Indicators")
                *
                * @property title
                * @type {String}
                * @default ""
                */</span>
                title: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * The text inside the subpanel. Can be String or a jQuery object. All nodes sporting CSS class
                * ".shorten-candidate" are treated to the shortening procedure - long strings are curtailed, and [more/less] links are placed at their ends.
                *
                * @property content
                * @type {String | jObject}
                * @default null
                */</span>
                content: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The node after which the panel will be inserted (e.g. node.find(".layer-details")).
                *
                * @property target
                * @type {jObject}
                * @default null
                */</span>
                target: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The name of the module that requested to open the SubPanel (e.g. "filterManager"). Used for identification of the panel's loyalty.
                *
                * @property origin
                * @type {String}
                * @default ""
                */</span>
                origin: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * A unique id of the SubPanel. If none provided, a random one is generated. It is used to determine the animation and update function
                * to run on content update.
                *
                * @property guid
                * @type {String}
                * @default ""
                */</span>
                guid: <span class="hljs-string">""</span>,
                <span class="hljs-comment">/**
                * Indicates that the open SubPanel request is a content update to the already opened SubPanel.
                * Does not trigger any of the `doOn-` or `doAfter-` functions.
                *
                * __Use case:__ the uses clicks on the metadata button.
                * 1. A request to open a SubPanel is sent with only the title since the metadata content is not yet available
                * 2. Metadata is fetched from the server
                * 3. A second request to open a SubPanel is sent having `update` set to `true` and featuring the __same__ `guid` as the first request
                * 4. Only the content of the SubPanel is updated; no extra animations are triggered
                *
                * @property update
                * @type {Boolean}
                * @default false
                */</span>
                update: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnOpen
                * @type {Function}
                * @default null
                */</span>
                doOnOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel finishes the opening animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterOpen
                * @type {Function}
                * @default null
                */</span>
                doAfterOpen: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel starts the closing animation; also triggered by updating panel content; can be triggered many times.
                *
                * @property doOnHide
                * @type {Function}
                * @default null
                */</span>
                doOnHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel becomes hidden; also triggered by updating panel content; can be triggered many times.
                *
                * @property doAfterHide
                * @type {Function}
                * @default null
                */</span>
                doAfterHide: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function when the panel is completely closed, its nodes destroyed; can be triggered only once in a lifespan of the panel.
                *
                * @property doOnDestroy
                * @type {Function}
                * @default null
                */</span>
                doOnDestroy: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The callback function executed after the SubPanel content is updated.
                * __Doesn't work correctly yet.__
                *
                * @property doAfterUpdate
                * @type {Function}
                * @default null
                */</span>
                doAfterUpdate: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The target number of chars after which a content text node will be shortened.
                *
                * @property showChars
                * @type {Number}
                * @default 170
                */</span>
                showChars: <span class="hljs-number">170</span>
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Panel Prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-comment">/**
        * [subPanelPrototype description]
        *
        * @class SubPanel
        * @constructor
        * @for GUI
        */</span>
            subPanelPrototype = {
                <span class="hljs-comment">/**
                * Indicates if the closing animation is under way.
                *
                * @property _closing
                * @private
                * @for SubPanel
                * @type {Boolean}
                * @default false
                */</span>
                _closing: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * Holds a deferred that would destory the panel after the closing animation completes. May be interrupted.
                *
                * @property _destroyDeferred
                * @type {Deferred}
                * @private
                * @default null
                */</span>
                _destroyDeferred: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * SubPanel attributes
                *
                * @property _attr
                * @private
                * @default null
                * @type {SubPanelSettings}
                */</span>
                _attr: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Indicates if the SubPanel is visible at the moment. Doesn't make the panel visible or invisible, just prevents animations on the content
                * to run when it is set to `true`.
                *
                * @property _visible
                * @private
                * @default false
                * @type {Boolean}
                */</span>
                _visible: <span class="hljs-literal">false</span>,
                <span class="hljs-comment">/**
                * The outermost `div` of the SubPanel.
                *
                * @property container
                * @default null
                * @type {jObject}
                */</span>
                container: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * The inner `div` of the SubPanel. Closing and opening animations are run on this `div`.
                *
                * @property panel
                * @default null
                * @type {jQobject}
                */</span>
                panel: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, including its title.
                *
                * @property _subPanelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>
                _subPanelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Heading of the content in the SubPanel.
                *
                * @property _panelTitle
                * @private
                * @default null
                * @type {jObject}
                */</span>
                _panelTitle: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * `div` housing the content of the SubPanel, excluding its title.
                *
                * @property _panelContentDiv
                * @private
                * @default null
                * @type {jObject}
                */</span>
                _panelContentDiv: <span class="hljs-literal">null</span>,
                <span class="hljs-comment">/**
                * Default duration of the SubPanel animation in milliseconds.
                *
                * @property _animatePanelDuration
                * @private
                * @default 400
                * @type {Number}
                */</span>
                _animatePanelDuration: <span class="hljs-number">400</span>,

                <span class="hljs-comment">/**
                * Apply the shortening plugin to the panel data
                *
                * @method parseContent
                * @param  {jObject} data Content to be shortened
                * @return {jObject} Content with after shortening long text nodes
                */</span>
                parseContent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>console.log(this._attr.showChars, jQuery.type(data), data);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> (jQuery.type(data) === <span class="hljs-string">"object"</span> ? data : $(data))
                        .find(<span class="hljs-string">".shorten-candidate"</span>).shorten({
                            showChars: <span class="hljs-keyword">this</span>._attr.showChars
                        })
                        .removeClass(<span class="hljs-string">"shorten-candidate"</span>).end();
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's settings object.
                *
                * @method getAttributes
                * @return {SubPanelSettings} This SubPanel's settings
                */</span>
                getAttributes: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr;
                },
                <span class="hljs-comment">/**
                * Returns this SubPanel's container `div`.
                *
                * @method getContainer
                * @return {jobject} This SubPanel's `div`
                */</span>
                getContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.container;
                },
                <span class="hljs-comment">/**
                * Retursn the inner `div` of the SubPanel
                *
                * @method getPanel
                * @return {jObject} The inner `div` of the SubPanel
                */</span>
                getPanel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.panel;
                },
                <span class="hljs-comment">/**
                * Returns the `origin` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `origin` of this SubPanel
                */</span>
                getOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.origin;
                },
                <span class="hljs-comment">/**
                * Returns the `guid` of this SubPanel.
                *
                * @method getOrigin
                * @return {String} The `guid` of this SubPanel
                */</span>
                getGuid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._attr.guid;
                },
                <span class="hljs-comment">/**
                * Destroys this SubPanel.
                *
                * @method destroy
                * @param  {Number} speed    The duration of the animation in milliseconds
                * @param  {Deferred} deferred The deffered to be resolved after the SubPanel is destroyed
                */</span>
                destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(speed, deferred)</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                        <span class="hljs-keyword">this</span>._attr.doOnHide();
                    }

                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">this</span>._destroyDeferred = deferred;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>remove CSS animation class to prevent flickering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);

                    sidePanel.getContainer().after(<span class="hljs-keyword">this</span>.container);
                    adjutSubPanelDimensions(<span class="hljs-keyword">this</span>);

                    <span class="hljs-keyword">this</span>.panel
                        .stop() <span class="hljs-comment">// stop opening animation if it's present</span>
                        .animate({
                            left: <span class="hljs-string">"100%"</span>
                        }, (speed || <span class="hljs-keyword">this</span>._animatePanelDuration), <span class="hljs-string">"easeOutCirc"</span>,
                            lang.hitch(<span class="hljs-keyword">this</span>,
                                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                        <span class="hljs-keyword">this</span>._attr.doAfterHide();
                                    }
                                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnDestroy) {
                                        <span class="hljs-keyword">this</span>._attr.doOnDestroy();
                                    }
                                    <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">false</span>;
                                    subPanelChange(<span class="hljs-literal">false</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-literal">null</span>);

                                    <span class="hljs-keyword">this</span>.container.remove();

                                    <span class="hljs-keyword">if</span> (deferred) {
                                        deferred.resolve(<span class="hljs-literal">true</span>);
                                    }
                                }
                            )
                    );
                },

                <span class="hljs-comment">/**
                * Reopens the SubPanel - stops the closing animation and initiates the opening animation.
                *
                * @method reopen
                */</span>
                reopen: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">this</span>.panel.stop();
                    <span class="hljs-keyword">this</span>._closing = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._destroyDeferred) {
                        <span class="hljs-keyword">this</span>._destroyDeferred.cancel();
                        <span class="hljs-keyword">this</span>._destroyDeferred = <span class="hljs-literal">null</span>;
                    }

                    <span class="hljs-keyword">this</span>.open();
                },

                <span class="hljs-comment">/**
                * Opens the SubPanel. Sends out `EventManager.GUI.SUBPANEL_CHANGE` event.
                *
                * @method open
                */</span>
                open: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnOpen) {
                        <span class="hljs-keyword">this</span>._attr.doOnOpen();
                    }
                    <span class="hljs-keyword">this</span>._visible = <span class="hljs-literal">true</span>;
                    subPanelChange(<span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>._attr.origin, <span class="hljs-keyword">this</span>.container);

                    <span class="hljs-keyword">this</span>.panel.animate({
                        left: <span class="hljs-number">0</span>
                    }, <span class="hljs-keyword">this</span>._animatePanelDuration, <span class="hljs-string">"easeOutCirc"</span>,
                        lang.hitch(<span class="hljs-keyword">this</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterOpen) {
                                    <span class="hljs-keyword">this</span>._attr.doAfterOpen();
                                }
                            }
                        )
                    );
                },

                <span class="hljs-comment">/**
                * Assigns a new origin to the SubPanel.
                *
                * @method changeOrigin
                * @param  {String} newOrigin The new origin of the SubPanel.
                */</span>
                changeOrigin: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newOrigin)</span> {</span>
                    <span class="hljs-keyword">this</span>._attr.origin = newOrigin;
                },

                <span class="hljs-comment">/**
                * Shifts the SubPanel to the new node in the DOM.
                *
                * @method shiftTarget
                * @param  {jObject} newTarget A node in the DOM to shift the SubPanel to
                */</span>
                shiftTarget: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newTarget)</span> {</span>
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.target !== newTarget) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>remove animation class to prevent flickering of data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">this</span>._subPanelContentDiv.find(<span class="hljs-string">".fadeInDown"</span>).removeClass(<span class="hljs-string">"fadeInDown"</span>);
                        newTarget.after(<span class="hljs-keyword">this</span>.container);
                        <span class="hljs-keyword">this</span>._attr.target = newTarget;
                    }
                },

                <span class="hljs-comment">/**
                * Creates a new instance of SubPanel.
                *
                * @method create
                * @param  {SubPanelSettings} a Settings for the SubPanel
                */</span>
                create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span>
                    <span class="hljs-keyword">var</span> subPanelContent,
                        subPanelString,
                        parsedContent;

                    console.log(<span class="hljs-string">"create panel, "</span>, a.origin);

                    a.guid = a.guid || util.guid();

                    lang.mixin(<span class="hljs-keyword">this</span>._attr, a);

                    subPanelContent = <span class="hljs-built_in">String</span>.format(subPanelContentTemplate, <span class="hljs-keyword">this</span>._attr.panelName, <span class="hljs-keyword">this</span>._attr.title);
                    subPanelString = <span class="hljs-built_in">String</span>.format(subPanelTemplate, subPanelContent);

                    <span class="hljs-keyword">this</span>.container = <span class="hljs-keyword">this</span>._attr.target.after(subPanelString).parent().find(<span class="hljs-string">".sub-panel-container"</span>);
                    <span class="hljs-keyword">this</span>.panel = <span class="hljs-keyword">this</span>.container.find(<span class="hljs-string">".sub-panel"</span>);

                    <span class="hljs-keyword">this</span>._subPanelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".sub-panel-content"</span>);
                    <span class="hljs-keyword">this</span>._panelTitle = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-title"</span>);
                    <span class="hljs-keyword">this</span>._panelContentDiv = <span class="hljs-keyword">this</span>.panel.find(<span class="hljs-string">".panel-content-div"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>set content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    parsedContent = <span class="hljs-keyword">this</span>.parseContent(<span class="hljs-keyword">this</span>._attr.content);
                    <span class="hljs-keyword">this</span>._panelContentDiv.empty().append(parsedContent);

                    <span class="hljs-keyword">this</span>.update(<span class="hljs-keyword">this</span>._attr);
                },

                <span class="hljs-comment">/**
                * Performs an update of the content and title of the SubPanel, running appropriate animation and `doOn-` / `doAfter-` functions.
                *
                * @method update
                * @param  {SubPanelSettings} a New settings for the SubPanel
                */</span>
                update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>helper functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> animateContentDuration = <span class="hljs-number">300</span>,
                        sOut = <span class="hljs-string">'&lt;ul class="loadingAnimation"&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;/ul&gt;'</span>,

                        updateDefered = [<span class="hljs-keyword">new</span> Deferred(), <span class="hljs-keyword">new</span> Deferred()],

                        animateContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node, newData, d)</span> {</span>
                            <span class="hljs-keyword">if</span> (newData) {
                                node.addClass(<span class="hljs-string">'animated fadeOutDown'</span>);
                                window.setTimeout(lang.hitch(<span class="hljs-keyword">this</span>,
                                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                            node</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>.html(newData)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                            .empty().append(newData)
                                                .removeClass(<span class="hljs-string">"fadeOutDown"</span>)
                                                .addClass(<span class="hljs-string">'animated fadeInDown'</span>); <span class="hljs-comment">//.find(".shorten-candidate").shorten();</span>

                                            d.resolve();
                                        }),
                                    animateContentDuration);
                            }
                        },

                        setContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node, oldData, newData, parsedData, visible, d)</span> {</span>
                            newData = (newData === <span class="hljs-literal">null</span>) ? parsedData = sOut : newData;
                            <span class="hljs-keyword">if</span> (newData) {
                                <span class="hljs-keyword">if</span> (newData !== oldData) {
                                    <span class="hljs-keyword">if</span> (visible) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>ideally, need to wait until the animation completes before proceedding?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                        animateContent(node, parsedData, d);
                                    } <span class="hljs-keyword">else</span> {
                                        node.empty().append(parsedData);
                                        d.resolve();
                                    }
                                } <span class="hljs-keyword">else</span> {
                                    d.resolve();
                                }
                            } <span class="hljs-keyword">else</span> {
                                d.resolve();
                            }
                        },

                        updateContent = lang.hitch(<span class="hljs-keyword">this</span>,
                            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a)</span> {</span>
                                <span class="hljs-keyword">this</span>._subPanelContentDiv.animate({
                                    scrollTop: <span class="hljs-number">0</span>
                                }, animateContentDuration, <span class="hljs-string">"easeOutCirc"</span>);

                                setContent(<span class="hljs-keyword">this</span>._panelTitle, <span class="hljs-keyword">this</span>._attr.title, a.title, a.title, <span class="hljs-keyword">this</span>._visible, updateDefered[<span class="hljs-number">0</span>]);
                                setContent(<span class="hljs-keyword">this</span>._panelContentDiv, <span class="hljs-keyword">this</span>._attr.content, a.content, <span class="hljs-keyword">this</span>.parseContent(a.content), <span class="hljs-keyword">this</span>._visible, updateDefered[<span class="hljs-number">1</span>]);

                                lang.mixin(<span class="hljs-keyword">this</span>._attr, a);
                            }
                        );</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>doAfterUpdate should be called AFTER update (animation) completesâ¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    util.afterAll(updateDefered, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        <span class="hljs-keyword">if</span> (a.doAfterUpdate) {
                            a.doAfterUpdate();
                        }
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>panel is closing; new data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._closing &amp;&amp; !a.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);
                        }

                        <span class="hljs-keyword">this</span>.reopen();</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>panel is not closing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._closing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>data is not an update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!a.update &amp;&amp; <span class="hljs-keyword">this</span>._attr.guid !== a.guid) {
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doOnHide) {
                                <span class="hljs-keyword">this</span>._attr.doOnHide();
                            }
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.doAfterHide) {
                                <span class="hljs-keyword">this</span>._attr.doAfterHide();
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>move panel to the new target</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            a.target.after(<span class="hljs-keyword">this</span>.container);
                            updateContent(a);

                            <span class="hljs-keyword">if</span> (a.doOnOpen) {
                                a.doOnOpen();
                            }
                            <span class="hljs-keyword">if</span> (a.doAfterOpen) {
                                a.doAfterOpen();
                            }
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>guid is the same - data can update or not (should be an update)
if (a.update &amp;&amp; attr.guid === a.guid) {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._attr.guid === a.guid) {
                            updateContent(a);
                        }
                    }
                }
            },

            mapToolbar = $(<span class="hljs-string">"#map-toolbar"</span>),

            helpToggle = $(<span class="hljs-string">"#helpToggle"</span>),
            helpSectionContainer = $(<span class="hljs-string">"#help-section-container"</span>),
            helpSection = $(<span class="hljs-string">"#help-section"</span>),

            addLayerToggle = $(<span class="hljs-string">"#addLayer-toggle"</span>),
            addLayerSectionContainer = $(<span class="hljs-string">"#addLayer-section-container"</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>AddLayerSection = $(â#addLayer-sectionâ),</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            viewPortHeight,
            footerHeight = wbFoot.height(),

        <span class="hljs-comment">/**
        * Specifies the hight of the footer in the full-screen mode. Should be smaller than `footerHeight`.
        *
        * @property footerDelta
        * @private
        * @type {Number}
        */</span>
            footerDelta = <span class="hljs-number">20</span>, <span class="hljs-comment">// the height of the footer in the fullscreen mode</span>

            fullScreenToggle = $(<span class="hljs-string">"#fullScreenToggle"</span>),

            titleBanner = $(<span class="hljs-string">"#gcwu-bnr"</span>),
            titleBannerHalfHeight = $(<span class="hljs-string">"#gcwu-title-in .ui-link"</span>).height() / <span class="hljs-number">2</span>,

        <span class="hljs-comment">/**
        * The height difference between the normal and full-screen modes.
        *
        * @property fullScreenDelta2
        * @private
        * @type {Number}
        */</span>
            fullScreenDelta2 = $(<span class="hljs-string">"nav[role='navigation']:first"</span>).height() +
                $(<span class="hljs-string">"#gcwu-psnb-in"</span>).height() +
                titleBannerHalfHeight +
                <span class="hljs-number">12</span> + footerDelta,

            megaMenuDiv = $(<span class="hljs-string">"#gcwu-psnb-in"</span>),
            megaMenu = megaMenuDiv.find(<span class="hljs-string">'.mb-menu'</span>),
            navigation = $(<span class="hljs-string">"nav[role='navigation']:first"</span>),
            megamenuBar = megaMenuDiv.find(<span class="hljs-string">".wet-boew-menubar"</span>),
            subTitleText = $(<span class="hljs-string">".cn-site-title-italic"</span>),

            cssButtonPressedClass = <span class="hljs-string">"button-pressed"</span>,
            cssExpandedClass = <span class="hljs-string">"state-expanded"</span>,

            helpPanelPopup,
            addLayerPanelPopup,

            sidePanel;

        <span class="hljs-comment">/**
        * SidePanel Class
        *
        * @class SidePanel
        * @constructor
        * @for GUI
        */</span>
        sidePanel = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">var</span> mapDiv = $(<span class="hljs-string">"#map-div"</span>),
                panelDiv = $(<span class="hljs-string">"#panel-div"</span>),
                panelToggle = $(<span class="hljs-string">"#panel-toggle"</span>),

                popup,

                panelWidthDefault;

            <span class="hljs-comment">/**
            * Publishes `PANEL_CHANGE` event when the visibility of the SidePanel changes.
            *
            * @method panelChange
            * @param  {Boolean} visible Indicates whether the SidePanel is visible or not
            * @for SidePanel
            * @private
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">panelChange</span><span class="hljs-params">(visible)</span> {</span>
                topic.publish(EventManager.GUI.PANEL_CHANGE, {
                    visible: visible
                });
            }

            <span class="hljs-comment">/**
            * Return the default width of the SidePanel.
            *
            * @method getPanelWidthDefault
            * @private
            * @return {Number} The default width of the SidePanel
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPanelWidthDefault</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (!panelWidthDefault) {
                    panelWidthDefault = panelDiv.width();
                }

                <span class="hljs-keyword">return</span> panelWidthDefault;
            }

            <span class="hljs-comment">/**
            * Slides the SidePanel open.
            *
            * @method openPanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openPanel</span><span class="hljs-params">(d)</span> {</span>
                <span class="hljs-comment">/*panelDiv.show();

                mapDiv.animate({
                width: mapDiv.width() - getPanelWidthDefault()
                }, "slow", "easeOutCirc");

                panelDiv.animate({
                right: 0
                }, "slow", "easeOutCirc", function () {
                layoutChange();
                panelChange(true);

                d.resolve();
                });*/</span>

                $(<span class="hljs-string">".viewport"</span>).removeClass(<span class="hljs-string">"side-panel-mode"</span>);

                window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    layoutChange();
                    panelChange(<span class="hljs-literal">true</span>);

                    d.resolve();
                }, <span class="hljs-number">500</span>);
            }

            <span class="hljs-comment">/**
            * Slide the SidePanel close
            *
            * @method closePanel
            * @private
            * @param  {Deferred} d A deferred to be resolved upon completion of the animation
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closePanel</span><span class="hljs-params">(d)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>animating map
               mapDiv.animate({
                   width: mapDiv.width() + getPanelWidthDefault()
               }, âslowâ, âeaseOutCircâ);</p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <pre><code>           <span class="hljs-comment">// animating panel</span>
           panelDiv.animate({
               right: -getPanelWidthDefault()
           }, <span class="hljs-string">"slow"</span>, <span class="hljs-string">"easeOutCirc"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
               panelDiv.hide();
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <pre><code>               util.subscribeOnce(<span class="hljs-string">"map/update-end"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                   console.log(<span class="hljs-string">"map/update-end from gui"</span>);
                   panelChange(<span class="hljs-literal">false</span>);
               });
               layoutChange();
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <pre><code>               d.resolve();
           });
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>
                $(<span class="hljs-string">".viewport"</span>).addClass(<span class="hljs-string">"side-panel-mode"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>mapDiv.css({ âwidthâ: mapDiv.width() + getPanelWidthDefault() });
panelDiv.css({ ârightâ: -getPanelWidthDefault() });</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    util.subscribeOnce(<span class="hljs-string">"map/update-end"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        console.log(<span class="hljs-string">"map/update-end from gui"</span>);
                        panelChange(<span class="hljs-literal">false</span>);
                    });
                    layoutChange();

                    d.resolve();
                }, <span class="hljs-number">500</span>);
            }

            <span class="hljs-keyword">return</span> {
                <span class="hljs-comment">/**
                * Initialize a newly create SidePanel.
                *
                * @method init
                */</span>
                init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    popup = popupManager.registerPopup(panelToggle, <span class="hljs-string">"click"</span>,
                        openPanel, {
                            activeClass: cssExpandedClass,
                            closeHandler: closePanel
                        }
                    );

                    topic.subscribe(EventManager.GUI.PANEL_TOGGLE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        popup.toggle();
                    });
                },

                <span class="hljs-comment">/**
                * Retunrs the outter most `div` of this SidePanel.
                *
                * @method getContainer
                * @return {jObject} The outter most `div` of this SidePanel
                */</span>
                getContainer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> panelDiv;
                },

                <span class="hljs-comment">/**
                * Gets the width of this SidePanel.
                *
                * @method width
                * @return {Number} The width of this SidePanel
                */</span>
                width: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    <span class="hljs-keyword">return</span> panelDiv.filter(<span class="hljs-string">":visible"</span>).width();
                }
            };
        } ());

        <span class="hljs-comment">/**
        * Create a new SubPanel with the settings provided.
        *
        * @private
        * @method newSubPanel
        * @param  {SubPanelSettings} attr SubPanel settings
        * @return {SubPanel}      A newly created SubPanel
        * @for GUI
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> subPanel = <span class="hljs-built_in">Object</span>.create(subPanelPrototype);
            subPanel._attr = <span class="hljs-built_in">Object</span>.create(subPanelAttr);
            subPanel.create(attr);
            adjutSubPanelDimensions(subPanel);

            <span class="hljs-keyword">return</span> subPanel;
        }

        <span class="hljs-comment">/**
        * Fires an event when the layout of the page changes.
        *
        * @method layoutChange
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">layoutChange</span><span class="hljs-params">()</span> {</span>
            topic.publish(EventManager.GUI.LAYOUT_CHANGE);
        }

        <span class="hljs-comment">/**
        * Fires an even when the subpanel closes or opens.
        *
        * @method subPanelChange
        * @private
        * @param {Boolean} visible indicates whether the panel is visible or not
        * @param {String} origin origin of the subpanel
        * @param {JObject} container subpanel container
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subPanelChange</span><span class="hljs-params">(visible, origin, container)</span> {</span>
            topic.publish(EventManager.GUI.SUBPANEL_CHANGE, {
                visible: visible,
                origin: origin,
                container: container,
                offsetLeft: (container) ? container.width() + <span class="hljs-number">25</span> + sidePanel.width() : sidePanel.width()
            });
        }

        <span class="hljs-comment">/**
        * Adjusts dimensions of the help panel relative to the mapContent `div`.
        *
        * @method adjustHelpDimensions
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustHelpDimensions</span><span class="hljs-params">()</span> {</span>
            helpSection.css({
                <span class="hljs-string">"max-height"</span>: mapContent.height() - <span class="hljs-number">56</span> <span class="hljs-comment">// 56 is an arbitrary-wide gap between the help panel and the upper toolbar</span>
            });
        }

        <span class="hljs-comment">/**
        * Adjusts the dimensions and position of the SubPanel when layout of the page is changing.
        *
        * @method adjutSubPanelDimensions
        * @private
        * @param  {SubPanel} subPanel SubPanel whose dimensions and position need to be adjusted
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjutSubPanelDimensions</span><span class="hljs-params">(subPanel)</span> {</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjust</span><span class="hljs-params">(p, d)</span> {</span>
                <span class="hljs-keyword">if</span> (p) {
                    p.getContainer()
                        .height(viewPortHeight - mapToolbar.height());

                    <span class="hljs-comment">/*.position({
                    my: "right top",
                    at: "right top+32",
                    of: "#map-div" // mapContent
                    });*/</span>
                    <span class="hljs-keyword">if</span> (d) {
                        d.resolve(<span class="hljs-literal">true</span>);
                    }
                }
            }

            <span class="hljs-keyword">if</span> (subPanel) {
                adjust(subPanel);
            } <span class="hljs-keyword">else</span> {
                util.executeOnDone(subPanels, adjust);
            }
        }

        <span class="hljs-comment">/**
        * Adjust the height of the body of the page on initial load and every page resize.
        *
        * @method adjustHeight
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustHeight</span><span class="hljs-params">()</span> {</span>
            viewPortHeight = jWindow.height() - wbHead.filter(<span class="hljs-string">":visible"</span>).height() - wbFoot.height();

            wbCore.height(viewPortHeight);
            mapContent.height(viewPortHeight - mapToolbar.height());

            adjustHelpDimensions();

            layoutChange();
        }

        <span class="hljs-comment">/**
        * Adjusts the width of the slide out panel and the map section.
        *
        * @method adjustWidth
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjustWidth</span><span class="hljs-params">()</span> {</span>
            adjustHeight();

            mapDiv.width(wbMainIn.width() - sidePanel.width());

            adjutSubPanelDimensions();
        }

        <span class="hljs-comment">/**
        * Animate the footer during full-screen transitions.
        *
        * @method toggleFooter
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleFooter</span><span class="hljs-params">()</span> {</span>
            wbFoot.animate({
                height: footerHeight - <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, footerDelta)
            }, <span class="hljs-string">"slow"</span>);
            footerDelta *= -<span class="hljs-number">1</span>;
        }

        <span class="hljs-comment">/**
        * Adjust the SubPanels to the full-screen mode of the page.
        *
        * @method toggleSubPanelContainer
        * @private
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleSubPanelContainer</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjust</span><span class="hljs-params">(p, d)</span> {</span>
                <span class="hljs-keyword">if</span> (p) {
                    p.getContainer().animate({
                        height: viewPortHeight + fullScreenDelta2 - <span class="hljs-number">32</span>,
                        top: p.getContainer().position().top - fullScreenDelta2 + footerDelta
                    }, <span class="hljs-string">"slow"</span>);
                    <span class="hljs-keyword">if</span> (d) {
                        d.resolve(<span class="hljs-literal">true</span>);
                    }
                }
            }

            util.executeOnDone(subPanels, adjust);
        }

        <span class="hljs-comment">/**
        * Creates and opens a new SubPanel with given settings.
        * If the SubPanel with the requested `origin` is already present, updates its content.
        *
        * @method showSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel instance
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(),
                subPanel;

            deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                attr = subPanel.getAttributes();
                subPanel = subPanels[attr.origin];
                subPanel.open();
                subPanel.getPanel().find(<span class="hljs-string">".sub-panel-toggle"</span>).on(<span class="hljs-string">"click"</span>,
                    lang.hitch(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        hideSubPanel(attr);
                    }));

                loadIndicator.animate({
                    right: subPanel.getPanel().width() + <span class="hljs-number">6</span>
                }, <span class="hljs-string">"easeOutCirc"</span>);
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>take over the panel spawned by other components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>if the panel exists, just update it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanels[attr.origin].update(attr);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!attr.update) {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>create if doesnât</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel = newSubPanel(attr);
                subPanels[attr.origin] = subPanel;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>close all other panels; and open the newly created one after all others are closed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                util.executeOnDone(subPanels,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(p, d)</span> {</span>
                        <span class="hljs-keyword">if</span> (p &amp;&amp; p.getOrigin() !== attr.origin) {
                            hideSubPanel({
                                origin: p.getOrigin()
                            }, <span class="hljs-number">200</span>, d);
                        } <span class="hljs-keyword">else</span> {
                            d.resolve(<span class="hljs-literal">true</span>);
                        }
                    },
                    deferred);
            }
        }

        <span class="hljs-comment">/**
        * Closes the SubPanel whose `origin` is specified in the `attr` parameter.
        *
        * @method hideSubPanel
        * @private
        * @param  {SubPanelSettings} attr  only `origin` attribute is required here
        * @param  {Number} speed Duration of the closing animation
        * @param  {Deferred} d     The deferred object to be resolved upon successful closing of the panel
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideSubPanel</span><span class="hljs-params">(attr, speed, d)</span> {</span>
            <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> Deferred(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> (d) {
                    d.cancel();
                }
            });

            deferred.then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>remove the panel from from the object after it closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">delete</span> subPanels[attr.origin]; <span class="hljs-comment">// more on delete: http://perfectionkills.com/understanding-delete/</span>
                <span class="hljs-keyword">if</span> (d) {
                    d.resolve(<span class="hljs-literal">true</span>);
                }
            });

            <span class="hljs-keyword">if</span> (subPanels[attr.origin]) {
                subPanels[attr.origin].destroy(speed, deferred);

                loadIndicator.animate({
                    right: <span class="hljs-number">3</span>
                }, <span class="hljs-string">"easeOutCirc"</span>);
            }
        }

        <span class="hljs-comment">/**
        * Moves the SubPanel with the specified `origin` in the DOM hierarchy to the new specified `target`; if `target` is not specified, the SubPanel is attached to the SidePanel.
        *
        * @method dockSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `target` and `origin` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dockSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> target = attr.target || sidePanel.getContainer(),
                subPanel = subPanels[attr.origin];

            <span class="hljs-keyword">if</span> (subPanel) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>console.log(âdocking subpanelâ);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                subPanel.shiftTarget(target);
            }
        }

        <span class="hljs-comment">/**
        * Finds a SubPanel with `origin` equal to the supplied `consumeOrigin` and
        * + changes its `origin` to the supplied `origin`
        * + moves the SubPanel in the DOM hierarchy and attaches it to the specified target
        *
        * @method captureSubPanel
        * @private
        * @param  {SubPanelSettings} attr Settings for the SubPanel; only `origin`, `consumeOrigin` and `target` are required here
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureSubPanel</span><span class="hljs-params">(attr)</span> {</span>
            <span class="hljs-keyword">var</span> subPanel;

            <span class="hljs-keyword">if</span> (attr.consumeOrigin === attr.origin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.origin];
                subPanel.shiftTarget(attr.target);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attr.consumeOrigin &amp;&amp; subPanels[attr.consumeOrigin]) {
                subPanel = subPanels[attr.consumeOrigin];
                subPanel.changeOrigin(attr.origin);
                subPanel.shiftTarget(attr.target);

                <span class="hljs-keyword">delete</span> subPanels[attr.consumeOrigin];
                subPanels[attr.origin] = subPanel;
            }
        }

        <span class="hljs-comment">/**
        * Toggles the FullScreen mode of the application
        *
        * @method toggleFullScreenMode
        * @private
        * @param  {boolean} fullscreen true/undefined - expand; false - collapse
        */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleFullScreenMode</span><span class="hljs-params">(fullscreen)</span> {</span>
            megaMenu.css({
                position: <span class="hljs-string">"static"</span>
            });
            subTitleText.css({
                position: <span class="hljs-string">"static"</span>
            });

            toggleSubPanelContainer();
            toggleFooter();

            wbCore.animate({
                height: viewPortHeight + fullScreenDelta2
            }, <span class="hljs-string">"slow"</span>);

            titleBanner.animate({
                height: titleBanner.height() - titleBannerHalfHeight
            }, <span class="hljs-string">"slow"</span>);

            <span class="hljs-keyword">if</span> (util.isUndefined(fullscreen)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>If expand is undefined, we toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                titleBannerHalfHeight *= -<span class="hljs-number">1</span>;
                fullScreenDelta2 *= -<span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fullscreen) {
                titleBannerHalfHeight = -<span class="hljs-number">1</span>;
                fullScreenDelta2 = -<span class="hljs-built_in">Math</span>.abs(fullScreenDelta2);
            } <span class="hljs-keyword">else</span> {
                titleBannerHalfHeight = <span class="hljs-number">1</span>;
                fullScreenDelta2 = <span class="hljs-built_in">Math</span>.abs(fullScreenDelta2);
            }

            <span class="hljs-keyword">var</span> strings = GlobalStorage.config.stringResources;
            fullScreenToggle.text(fullScreenDelta2 &lt; <span class="hljs-number">0</span> ? strings.txtShowHeaders : strings.txtFullScreen);

            navigation.slideToggle(<span class="hljs-string">"slow"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>subTitleText.slideToggle(âfastâ);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            megaMenuDiv.slideToggle(<span class="hljs-string">"slow"</span>,
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    megaMenu.removeAttr(<span class="hljs-string">'style'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>needed to prevent âdisappearing toolbarâ effect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    megamenuBar.css({
                        <span class="hljs-string">"min-height"</span>: <span class="hljs-string">"32px"</span>
                    });

                    adjustHeight();
                    adjutSubPanelDimensions();
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>fullScreenDelta2 is positive when the map is collapsed
and negative when the map is expanded
Event used in BookmarkLink</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            topic.publish(EventManager.GUI.FULLSCREEN_CHANGE, {
                fullscreen: (fullScreenDelta2 &lt; <span class="hljs-number">0</span>)
            });
        }

        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">/**
            * Call load to initialize the GUI module.
            *
            * @method load
            * @param  {Number} id   ID of this module
            * @param  {?} req  ???
            * @param  {Function} load The callback function
            */</span>
            load: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id, req, load)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>measure available space on every page resize
jWindow.on(âresizeâ, adjustWidth);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                sidePanel.init();</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>registring help popup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                helpPanelPopup = popupManager.registerPopup(helpToggle, <span class="hljs-string">"click"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                        topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, {
                            visible: <span class="hljs-literal">true</span>
                        });
                        console.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">true</span>);

                        helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            d.resolve();
                        });
                    }, {
                        activeClass: cssButtonPressedClass,
                        target: helpSectionContainer,
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                            topic.publish(EventManager.GUI.HELP_PANEL_CHANGE, {
                                visible: <span class="hljs-literal">false</span>
                            });
                            console.log(EventManager.GUI.HELP_PANEL_CHANGE + <span class="hljs-string">"; visible:"</span>, <span class="hljs-literal">false</span>);

                            helpSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                d.resolve();
                            });
                        }
                    }
                );

                topic.subscribe(EventManager.BookmarkLink.GETLINKPANEL_CHANGED, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">if</span> (helpPanelPopup.isOpen() &amp;&amp; attr.visible) {
                        helpPanelPopup.close();
                    }
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Start AddLayer popup controller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                addLayerPanelPopup = popupManager.registerPopup(addLayerToggle, <span class="hljs-string">"click"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                        topic.publish(EventManager.GUI.ADD_LAYER_PANEL_CHANGE, {
                            visible: <span class="hljs-literal">true</span>
                        });
                        console.log(EventManager.GUI.ADD_LAYER_PANEL_CHANGE + <span class="hljs-string">" visible:"</span>, <span class="hljs-literal">true</span>);

                        addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            d.resolve();
                        });
                    }, {
                        activeClass: cssButtonPressedClass,
                        target: addLayerSectionContainer,
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                            topic.publish(EventManager.GUI.ADD_LAYER_PANEL_CHANGE, {
                                visible: <span class="hljs-literal">false</span>
                            });
                            console.log(EventManager.GUI.ADD_LAYER_PANEL_CHANGE + <span class="hljs-string">" visible:"</span>, <span class="hljs-literal">false</span>);

                            addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                                d.resolve();
                            });
                        }
                    }
                );

                topic.subscribe(EventManager.BookmarkLink.GETLINKPANEL_CHANGED, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">if</span> (addLayerPanelPopup.isOpen() &amp;&amp; attr.visible) {
                        addLayerPanelPopup.close();
                    }
                });

                $(<span class="hljs-string">"#addLayer-add"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    topic.publish(EventManager.Map.ADD_LAYER, <span class="hljs-literal">null</span>);

                    addLayerSectionContainer.slideToggle(<span class="hljs-string">"fast"</span>);
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>End Add Layer</p>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>start extended grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                topic.subscribe(<span class="hljs-string">"gui/grid/expand"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    $(<span class="hljs-string">".viewport"</span>).toggleClass(<span class="hljs-string">"data-panel-mode"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <pre><code>               console.log(<span class="hljs-string">"grid expansion event started"</span>);
               $(<span class="hljs-string">"#map-div"</span>).addClass(<span class="hljs-string">"wb-invisible"</span>);
               $(<span class="hljs-string">"#panel-div"</span>).addClass(<span class="hljs-string">"wb-invisible"</span>);
               $(<span class="hljs-string">"#panel-fullgrid"</span>).removeClass(<span class="hljs-string">"wb-invisible"</span>);
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>                });</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <pre><code>           $(<span class="hljs-string">"#full-grid-collapse"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
               topic.publish(<span class="hljs-string">"gui/grid/collapse"</span>);
           });
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <pre><code>           topic.subscribe(<span class="hljs-string">"gui/grid/collapse"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
               console.log(<span class="hljs-string">"grid collapse event started"</span>);
               $(<span class="hljs-string">"#map-div"</span>).removeClass(<span class="hljs-string">"wb-invisible"</span>);
               $(<span class="hljs-string">"#panel-div"</span>).removeClass(<span class="hljs-string">"wb-invisible"</span>);
               $(<span class="hljs-string">"#panel-fullgrid"</span>).addClass(<span class="hljs-string">"wb-invisible"</span>);
           });
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <pre><code>           $(<span class="hljs-string">"#full-grid-test"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
               topic.publish(EventManager.GUI.SUBPANEL_OPEN, {
                   panelName: <span class="hljs-string">"Grid Details"</span>,
                   title: <span class="hljs-string">"Title"</span>,
                   content: <span class="hljs-string">"&lt;p&gt;panel content!!!!&lt;/p&gt;"</span>,
                   target: $(<span class="hljs-string">"#fullgrid-top-panel"</span>),
                   origin: <span class="hljs-string">"fullgrid-top-panel"</span>,
                   consumeOrigin: <span class="hljs-string">"fullgrid-top-panel"</span>,
                   guid: <span class="hljs-number">1000</span>,
                   doOnOpen: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                   },
                   doOnHide: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                   },
                   doOnDestroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                   }
               });
           });
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>end extended grid
fullScreenToggle.click(toggleFullScreenMode);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                fullScreenToggle.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    $(<span class="hljs-string">'body'</span>).toggleClass(<span class="hljs-string">"full-screen"</span>);
                    window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                        layoutChange();
                    }, <span class="hljs-number">500</span>);
                });
                topic.subscribe(EventManager.GUI.TOGGLE_FULLSCREEN, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(evt)</span> {</span>
                    toggleFullScreenMode(evt.expand);
                    $(<span class="hljs-string">'body'</span>).toggleClass(<span class="hljs-string">"full-screen"</span>);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_OPEN, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    showSubPanel(attr);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CLOSE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">if</span> (attr.origin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>attr.origin = key;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: key
                            });
                        });
                    } <span class="hljs-keyword">else</span> {
                        dojoArray.forEach(attr.origin.split(<span class="hljs-string">","</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>attr.origin = element;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            hideSubPanel({
                                origin: element
                            });
                        });
                    }
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_DOCK, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    dockSubPanel(attr);
                });

                topic.subscribe(EventManager.GUI.SUBPANEL_CAPTURE, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> {</span>
                    <span class="hljs-keyword">var</span> na;

                    <span class="hljs-keyword">if</span> (attr.consumeOrigin === <span class="hljs-string">"all"</span>) {
                        utilDict.forEachEntry(subPanels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = key;
                            captureSubPanel(na);
                        });
                    } <span class="hljs-keyword">else</span> {
                        dojoArray.forEach(attr.consumeOrigin.split(<span class="hljs-string">","</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> {</span>
                            na = <span class="hljs-built_in">Object</span>.create(attr);
                            na.consumeOrigin = element;
                            captureSubPanel(na);
                        });
                    }
                    console.log(EventManager.GUI.SUBPANEL_CAPTURE);
                });

                panelTabs.find(<span class="hljs-string">"li a"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                    topic.publish(EventManager.GUI.TAB_SELECTED, {
                        id: <span class="hljs-keyword">this</span>.id,
                        tabName: <span class="hljs-keyword">this</span>.attributes[<span class="hljs-string">"data-panel-name"</span>].value
                    });

                    panelTabs.find(<span class="hljs-string">"li:not(.active) a"</span>).each(
                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                            topic.publish(EventManager.GUI.TAB_DESELECTED, {
                                id: <span class="hljs-keyword">this</span>.id,
                                tabName: <span class="hljs-keyword">this</span>.attributes[<span class="hljs-string">"data-panel-name"</span>].value
                            });
                        });
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>adjustWidth();</p>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>if the vertical space is too small, trigger the full-screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (mapContent.height() &lt; jWindow.height() * <span class="hljs-number">0.6</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>toggleFullScreenMode(true);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                }

                popupManager.registerPopup($(<span class="hljs-string">"#tools"</span>), <span class="hljs-string">"hoverIntent"</span>,
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                        $(<span class="hljs-string">"#tools-container"</span>).slideDown(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> d.resolve(); });
                    },
                    {
                        activeClass: cssButtonPressedClass,
                        target: $(<span class="hljs-string">"#tools-container"</span>),
                        closeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> {</span>
                            $(<span class="hljs-string">"#tools-container"</span>).slideUp(<span class="hljs-string">"fast"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> d.resolve(); });
                        },
                        timeout: <span class="hljs-number">500</span>
                    }
                );</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>return the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                load();
            }
        };
    }
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
